# Movie-explorer-api
## Бэкенд приложение дипломной работы ЯПрактикума, факультета "Веб-разработки"

Приложение построенное на основе `Express framework`. Работает с базой данных `MongoDb` с помощью библиотеки [`Mongoose`](https://mongoosejs.com/).  Все входящие данные проверяются c помощью [Celebrate](https://www.npmjs.com/package/celebrate). Производится запись всех поступающих запросов и ошибок в логи с помощью [Winston](https://github.com/winstonjs/winston).
Ограничить частоту запросов помогает [express-rate-limit](https://www.npmjs.com/package/express-rate-limit). \
### Создаются коллекции `users` и `movies`: 
- При создании документа `user` проверяется уникальность поля `email`. Пароль в базу записывается в зашифрованном виде. \
- Документ `movie` связывается с пользователем, при попытке создания проверяется уникальность этой связки, при удалении документа проверяется совпадение поля `owner` с текущим пользователем.

### Роутеры:

- POST `/signup` - создаёт пользователя с переданными в теле email, password и name;
- POST `/signin` - проверяет переданные в теле почту и пароль и возвращает JWT
- POST `signout` - при запросе удалится JWT из куков пользователя

- GET `/users/me` - получить данные текущего пользователя
- PATCH `/users/me` - изменить данные пользователя email&name
- GET `/movies` - все документы movies пользователя
- POST `/movies` - создать документ movies
- DELETE `/movies/:id` - удалить документ movies по id

Все необработанные пути попадают в специальный контроллер.

### Схемы:

#### `userScheme`
 - `email` — почта пользователя, по которой он регистрируется. Это обязательное поле, уникальное для каждого пользователя. Также оно валидируется на соответствие схеме электронной почты.
- `password` — хеш пароля. Обязательное поле-строка.
- `name` — имя пользователя, например: Александр или Мария. Это обязательное поле-строка от 2 до 30 символов.

#### `movie`
- `country` — страна создания фильма. Обязательное поле-строка.
- `director` — режиссёр фильма. Обязательное поле-строка.
- `duration` — длительность фильма. Обязательное поле-число.
- `year` — год выпуска фильма. Обязательное поле-строка.
- `description` — описание фильма. Обязательное поле-строка.
- `image` — ссылка на постер к фильму. Обязательное поле-строка. URL-адрес.
- `trailerLink` — ссылка на трейлер фильма. Обязательное поле-строка.  URL-адрес.
- `thumbnail` — миниатюрное изображение постера к фильму. Обязательное поле-строка.  URL-адрес.
- `owner` — _id пользователя, который сохранил фильм. Обязательное поле.
- `movieId` — id фильма, который содержится в ответе сервиса MoviesExplorer. Обязательное поле.
- `nameRU` — название фильма на русском языке. Обязательное поле-строка.
- `nameEN` — название фильма на английском языке. Обязательное поле-строка.
### Переменные окружения, дефолтные значения:

- `JWT_SECRET` = 'some-secret-key';
- `PATH_MONGO` = 'mongodb://localhost:27017/bitfilmsdb'
- `PORT` = 3000
- `ALLOWED_CORS` = ['http://localhost:3001']

`IP`: 158.160.21.58 \
`url`: https://api.movie.klazar.online
